# UIæ”¹å–„ãƒ—ãƒ©ãƒ³ v4.0ï¼šä¸­é•·æœŸçš„æ§‹é€ æ”¹å–„ã®è©³ç´°å®Ÿè£…è¨ˆç”»

## ğŸ“‹ æ¦‚è¦

**ä½œæˆæ—¥**: 2025-10-07  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 4.0  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ææ¡ˆä¸­  
**å„ªå…ˆåº¦**: Medium-High  
**å·¥æ•°è¦‹ç©**: 8é€±é–“ï¼ˆ1äººï¼‰/ 4é€±é–“ï¼ˆ2äººï¼‰  
**å‰ææ¡ä»¶**: v3.0 Phase 1-4ã®å®Œäº†

### v3.0ã‹ã‚‰ã®ä½ç½®ã¥ã‘

v3.0 Phase 1-4å®Œäº†ã«ã‚ˆã‚Šã€ä»¥ä¸‹ãŒé”æˆã•ã‚Œã¾ã™ï¼š
- âœ… ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¢ã‚¦ã‚§ã‚¢ãªUIï¼ˆ0.5æ—¥ï¼‰
- âœ… ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸30-60%ï¼ˆ1.0æ—¥ï¼‰
- âœ… CI/CDå“è³ªã‚²ãƒ¼ãƒˆå®Ÿè£…ï¼ˆ1.0æ—¥ï¼‰
- âœ… åŸºæœ¬çš„ãªç›£è¦–åŸºç›¤ï¼ˆ0.5æ—¥ï¼‰

**v4.0ã®ç›®çš„**ï¼š
ã•ã‚‰ãªã‚‹å“è³ªå‘ä¸Šã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§å‘ä¸Šã®ãŸã‚ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ãƒ™ãƒ«ã®æ§‹é€ æ”¹å–„ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚

## ğŸ¯ ç›®çš„ã¨ç›®æ¨™

### ä¸»ç›®çš„

1. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹å–„**: å·¨å¤§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ†å‰²ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢
2. **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š**: å¤–éƒ¨ä¾å­˜ã®æŠ½è±¡åŒ–ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã®å‘ä¸Š
3. **å“è³ªä¿è¨¼å¼·åŒ–**: E2Eãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ã®è‡ªå‹•æ¤œè¨¼

### å®šé‡çš„ç›®æ¨™

| æŒ‡æ¨™ | v3.0å®Œäº†æ™‚ | v4.0å®Œäº†æ™‚ | æ”¹å–„ç‡ |
|------|-----------|-----------|--------|
| ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ | 30-60% | 70%+ | +17-133% |
| App.tsxã®è¡Œæ•° | 1,707è¡Œ | 500è¡Œä»¥ä¸‹ | -71% |
| å¹³å‡ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ | 10-30ç§’ | 5ç§’ä»¥ä¸‹ | -83% |
| ãƒã‚°æ¤œå‡ºæ™‚é–“ | æ•°æ™‚é–“ | æ•°åˆ† | -99% |
| æ–°æ©Ÿèƒ½é–‹ç™ºé€Ÿåº¦ | åŸºæº– | 1.5å€ | +50% |

## ğŸ“Š ç¾çŠ¶åˆ†æã¨èª²é¡Œ

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æ

```
ç¾çŠ¶ã®æ§‹é€ çš„èª²é¡Œ:
â”œâ”€ App.tsx: 1,707è¡Œ (0%ã‚«ãƒãƒ¼)
â”‚  â”œâ”€ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨UIã®å¯†çµåˆ
â”‚  â”œâ”€ çŠ¶æ…‹ç®¡ç†ã®è¤‡é›‘æ€§
â”‚  â””â”€ ãƒ†ã‚¹ãƒˆå›°é›£æ€§
â”‚
â”œâ”€ Firebaseç³»: 1,095è¡Œ (0%ã‚«ãƒãƒ¼)
â”‚  â”œâ”€ ç›´æ¥çš„ãªå¤–éƒ¨ä¾å­˜
â”‚  â”œâ”€ ãƒ¢ãƒƒã‚¯ã®è¤‡é›‘æ€§
â”‚  â””â”€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé€Ÿåº¦ã®ä½ä¸‹
â”‚
â””â”€ å¤§è¦æ¨¡UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: 2,500è¡Œ+
   â”œâ”€ çµ±åˆãƒ†ã‚¹ãƒˆä¸è¶³
   â”œâ”€ ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®æœªæ¤œè¨¼
   â””â”€ ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ¤œå‡ºã®å›°é›£æ€§
```

### ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§ãƒ¡ãƒ¢ï¼ˆé‡è¦ï¼‰

å®Ÿè£…è¨ˆç”»ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã¨ã€ç¾è¡Œã‚³ãƒ¼ãƒ‰ã®å‹/ä»•æ§˜å·®åˆ†ã‚’å…ˆã«æ˜ç¤ºã—ã¾ã™ã€‚

- HitResultï¼ˆæ‰“æ’ƒçµæœï¼‰: ç¾è¡Œã¯ `src/types/index.ts` ã® `HitResult` å‹ã‚’ä½¿ç”¨ã€‚ã‚·ãƒ³ã‚°ãƒ«ã¯ `IH`/`LH`/`CH`/`RH`ã€äºŒå¡æ‰“ã¯ `2B`ã€ä¸‰å¡æ‰“ã¯ `3B`ã€ä¸‰æŒ¯ã¯ `SO`ã€‚è¨ˆç”»æ›¸ã® `IIH`/`IIIH`/`K` ã¯ãã‚Œãã‚Œ `2B`/`3B`/`SO` ã«èª­ã¿æ›¿ãˆã¾ã™ã€‚
- RunEventï¼ˆå¾—ç‚¹ã‚¤ãƒ™ãƒ³ãƒˆï¼‰: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ `runCount` ã¨ `isTop` ã‚’ä½¿ç”¨ï¼ˆ`runs` ã§ã¯ãªã„ï¼‰ã€‚
- å¾—ç‚¹è¨ˆç®—: ã‚¹ã‚³ã‚¢ã¯ã€Œæ‰“å¸­ã®æ‰“ç‚¹ `AtBat.rbi`ã€ã¨ã€Œå¾—ç‚¹ã‚¤ãƒ™ãƒ³ãƒˆ `RunEvent.runCount`ã€ã®åˆè¨ˆã€‚`ScoreBoard` ã¯ã€Œå…ˆæ”»=è¡¨ï¼ˆ`isTop: true`ï¼‰ã€å¾Œæ”»=è£ï¼ˆ`isTop: false`ï¼‰ã€å‰æã§è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚
- ã‚¤ãƒ‹ãƒ³ã‚°æ•°: ç¾è¡ŒUIã¯æœ€å¤§7å›è¡¨ç¤ºã‚’å‰æã«ã—ã¦ãŠã‚Šï¼ˆå°‘å¹´é‡çƒè¨­å®šï¼‰ã€ä¾‹ã¯ã“ã®å‰æã§è¨˜è¿°ã—ã¾ã™ã€‚
- Provideræ§‹æˆ: `AuthProvider` ã¯ `App` å†…ã§ãƒ©ãƒƒãƒ—ã•ã‚Œã¦ã„ã¾ã™ã€‚DIï¼ˆRepositoryProviderï¼‰å°å…¥æ™‚ã¯ `App` å†…ã«è¿½åŠ ã™ã‚‹ã‹ã€`index.tsx` å´ã«ç§»è¨­ã™ã‚‹æ–¹é‡ã‚’æ˜è¨˜ã—ã¾ã™ã€‚

### æŠ€è¡“çš„è² å‚µã®å®šé‡åŒ–

| è² å‚µé …ç›® | å½±éŸ¿åº¦ | ç·Šæ€¥åº¦ | å¯¾å¿œPhase |
|---------|--------|--------|----------|
| App.tsxã®è‚¥å¤§åŒ– | é«˜ | é«˜ | Phase 5a |
| Firebaseå¯†çµåˆ | é«˜ | ä¸­ | Phase 5b |
| E2Eãƒ†ã‚¹ãƒˆä¸åœ¨ | ä¸­ | ä¸­ | Phase 5c |
| ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯æ•£åœ¨ | é«˜ | é«˜ | Phase 5a |
| ã‚«ã‚¹ã‚¿ãƒ Hooksä¸è¶³ | ä¸­ | ä¸­ | Phase 5a |

---

## ğŸ—ï¸ Phase 5a: App.tsxã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆ3.0æ—¥ï¼‰

### ç›®çš„

1,707è¡Œã®å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚¹ãƒˆå¯èƒ½ãªå˜ä½ã«åˆ†å‰²ã—ã€ä¿å®ˆæ€§ã¨ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚

### ğŸš¨ã€é‡è¦ã€‘ä¸€æ™‚çš„ãªã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ã®ç·©å’Œ

ç¾åœ¨ã€CIã®å“è³ªã‚²ãƒ¼ãƒˆã§ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ã‚’ä¸€æ™‚çš„ã«**5%**ã«ç·©å’Œã—ã¦ã„ã¾ã™ã€‚Phase 5aã®å®Œäº†ã‚’ã‚‚ã£ã¦ã€**30%**ã«æˆ»ã™ã“ã¨ã‚’å¿…é ˆã¨ã—ã¾ã™ã€‚

### å®Ÿè£…æˆ¦ç•¥ï¼šæ®µéšçš„åˆ†é›¢ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**åŸå‰‡**ï¼š
- âœ… æ—¢å­˜æ©Ÿèƒ½ã‚’å£Šã•ãªã„ï¼ˆæ©Ÿèƒ½ãƒ•ãƒªãƒ¼ã‚ºãªã—ï¼‰
- âœ… å°ã•ãåˆ†å‰²ã—ã¦æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆ
- âœ… å„ã‚¹ãƒ†ãƒƒãƒ—ã§å“è³ªæ¤œè¨¼ã‚’å®Ÿæ–½
- âœ… ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½ãªå˜ä½ã§ã‚³ãƒŸãƒƒãƒˆ

---

### Step 5a-1: ã‚«ã‚¹ã‚¿ãƒ HooksæŠ½å‡ºï¼ˆ1.5æ—¥ï¼‰

#### å¯¾è±¡ãƒ­ã‚¸ãƒƒã‚¯ã®ç‰¹å®š

App.tsxã‹ã‚‰æŠ½å‡ºã™ã¹ããƒ­ã‚¸ãƒƒã‚¯ï¼ˆå„ªå…ˆåº¦é †ï¼‰ï¼š

| Hookå | è²¬å‹™ | è¡Œæ•° | å„ªå…ˆåº¦ | å·¥æ•° |
|--------|------|------|--------|------|
| useGameState | è©¦åˆçŠ¶æ…‹ç®¡ç† | ~300 | æœ€é«˜ | 0.5æ—¥ |
| useScoreCalculation | ã‚¹ã‚³ã‚¢è¨ˆç®— | ~200 | é«˜ | 0.3æ—¥ |
| useTeamManagement | ãƒãƒ¼ãƒ ç®¡ç† | ~250 | é«˜ | 0.3æ—¥ |
| useInningControl | ã‚¤ãƒ‹ãƒ³ã‚°åˆ¶å¾¡ | ~150 | ä¸­ | 0.2æ—¥ |
| useAtBatHistory | æ‰“å¸­å±¥æ­´ç®¡ç† | ~100 | ä¸­ | 0.2æ—¥ |

#### å®Ÿè£…1-1: useGameStateï¼ˆ0.5æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/hooks/useGameState.ts`

```typescript
import { useState, useCallback } from 'react';
import { Game, Team, AtBat, RunEvent } from '../types';

export interface GameState {
  homeTeam: Team;
  awayTeam: Team;
  currentInning: number;
  isTop: boolean;
  outs: number;
  runners: { first: boolean; second: boolean; third: boolean };
}

export interface GameStateActions {
  setHomeTeam: (team: Team) => void;
  setAwayTeam: (team: Team) => void;
  addAtBat: (atBat: AtBat) => void;
  updateInning: (inning: number, isTop: boolean) => void;
  resetGame: () => void;
  loadGame: (game: Game) => void;
}

export interface UseGameStateReturn {
  state: GameState;
  actions: GameStateActions;
}

/**
 * è©¦åˆçŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ Hook
 * 
 * @param initialGame - åˆæœŸåŒ–ç”¨ã®è©¦åˆãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
 * @returns è©¦åˆçŠ¶æ…‹ã¨æ“ä½œé–¢æ•°
 * 
 * @example
 * ```tsx
 * const { state, actions } = useGameState();
 * actions.addAtBat({ playerId: '1', result: 'IH' });
 * ```
 */
export const useGameState = (initialGame?: Game): UseGameStateReturn => {
  const [homeTeam, setHomeTeam] = useState<Team>(() => 
    initialGame?.homeTeam || createEmptyTeam()
  );
  
  const [awayTeam, setAwayTeam] = useState<Team>(() => 
    initialGame?.awayTeam || createEmptyTeam()
  );
  
  const [currentInning, setCurrentInning] = useState(
    initialGame?.currentInning || 1
  );
  
  const [isTop, setIsTop] = useState(
    initialGame?.isTop ?? true
  );
  
  const [outs, setOuts] = useState(0);
  
  const [runners, setRunners] = useState({
    first: false,
    second: false,
    third: false,
  });

  /**
   * æ‰“å¸­çµæœã‚’è¿½åŠ 
   */
  const addAtBat = useCallback((atBat: AtBat) => {
    const currentTeam = isTop ? awayTeam : homeTeam;
    const setCurrentTeam = isTop ? setAwayTeam : setHomeTeam;

    // æ‰“å¸­è¨˜éŒ²ã‚’è¿½åŠ 
    const updatedAtBats = [...currentTeam.atBats, atBat];
    
    setCurrentTeam({
      ...currentTeam,
      atBats: updatedAtBats,
    });

    // ã‚¢ã‚¦ãƒˆã‚«ã‚¦ãƒ³ãƒˆã€ãƒ©ãƒ³ãƒŠãƒ¼çŠ¶æ…‹ã®æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯
    // ï¼ˆæ—¢å­˜ã®App.tsxã‹ã‚‰ç§»è¡Œï¼‰
  }, [homeTeam, awayTeam, isTop, outs, runners]);

  /**
   * ã‚¤ãƒ‹ãƒ³ã‚°ã‚’æ›´æ–°
   */
  const updateInning = useCallback((inning: number, top: boolean) => {
    setCurrentInning(inning);
    setIsTop(top);
    setOuts(0);
    setRunners({ first: false, second: false, third: false });
  }, []);

  /**
   * è©¦åˆã‚’ãƒªã‚»ãƒƒãƒˆ
   */
  const resetGame = useCallback(() => {
    setHomeTeam(createEmptyTeam());
    setAwayTeam(createEmptyTeam());
    setCurrentInning(1);
    setIsTop(true);
    setOuts(0);
    setRunners({ first: false, second: false, third: false });
  }, []);

  /**
   * ä¿å­˜æ¸ˆã¿è©¦åˆã‚’èª­ã¿è¾¼ã¿
   */
  const loadGame = useCallback((game: Game) => {
    setHomeTeam(game.homeTeam);
    setAwayTeam(game.awayTeam);
    setCurrentInning(game.currentInning);
    setIsTop(game.isTop);
    // ãã®ä»–ã®çŠ¶æ…‹ã‚‚å¾©å…ƒ
  }, []);

  return {
    state: {
      homeTeam,
      awayTeam,
      currentInning,
      isTop,
      outs,
      runners,
    },
    actions: {
      setHomeTeam,
      setAwayTeam,
      addAtBat,
      updateInning,
      resetGame,
      loadGame,
    },
  };
};

// ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
const createEmptyTeam = (): Team => ({
  name: '',
  players: [],
  atBats: [],
  // ... ãã®ä»–ã®åˆæœŸå€¤
});
```

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/hooks/__tests__/useGameState.test.ts`

```typescript
import { renderHook, act } from '@testing-library/react';
import { useGameState } from '../useGameState';
import { AtBat } from '../../types';

describe('useGameState', () => {
  test('åˆæœŸçŠ¶æ…‹ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹', () => {
    const { result } = renderHook(() => useGameState());

    expect(result.current.state.currentInning).toBe(1);
    expect(result.current.state.isTop).toBe(true);
    expect(result.current.state.outs).toBe(0);
  });

  test('æ‰“å¸­ã‚’è¿½åŠ ã§ãã‚‹', () => {
    const { result } = renderHook(() => useGameState());

    act(() => {
      result.current.actions.setAwayTeam({
        name: 'ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒ ',
        players: [{ id: 'p1', name: 'é¸æ‰‹1', number: 1 }],
        atBats: [],
      });
    });

    const atBat: AtBat = {
      playerId: 'p1',
      result: 'IH',
      inning: 1,
      isTop: true,
      timestamp: Date.now(),
    };

    act(() => {
      result.current.actions.addAtBat(atBat);
    });

    expect(result.current.state.awayTeam.atBats).toHaveLength(1);
    expect(result.current.state.awayTeam.atBats[0]).toEqual(atBat);
  });

  test('ã‚¤ãƒ‹ãƒ³ã‚°ã‚’æ›´æ–°ã§ãã‚‹', () => {
    const { result } = renderHook(() => useGameState());

    act(() => {
      result.current.actions.updateInning(2, false);
    });

    expect(result.current.state.currentInning).toBe(2);
    expect(result.current.state.isTop).toBe(false);
    expect(result.current.state.outs).toBe(0);
  });

  test('è©¦åˆã‚’ãƒªã‚»ãƒƒãƒˆã§ãã‚‹', () => {
    const { result } = renderHook(() => useGameState());

    act(() => {
      result.current.actions.updateInning(5, false);
      result.current.actions.resetGame();
    });

    expect(result.current.state.currentInning).toBe(1);
    expect(result.current.state.isTop).toBe(true);
  });

  test('ä¿å­˜æ¸ˆã¿è©¦åˆã‚’èª­ã¿è¾¼ã‚ã‚‹', () => {
    const { result } = renderHook(() => useGameState());

    const savedGame = {
      homeTeam: { name: 'ãƒ›ãƒ¼ãƒ ', players: [], atBats: [] },
      awayTeam: { name: 'ã‚¢ã‚¦ã‚§ã‚¤', players: [], atBats: [] },
      currentInning: 3,
      isTop: false,
    };

    act(() => {
      result.current.actions.loadGame(savedGame);
    });

    expect(result.current.state.homeTeam.name).toBe('ãƒ›ãƒ¼ãƒ ');
    expect(result.current.state.currentInning).toBe(3);
    expect(result.current.state.isTop).toBe(false);
  });
});
```

**App.tsxã§ã®ä½¿ç”¨æ–¹æ³•**:

```typescript
// Before
const [homeTeam, setHomeTeam] = useState<Team>(/* ... */);
const [awayTeam, setAwayTeam] = useState<Team>(/* ... */);
const [currentInning, setCurrentInning] = useState(1);
// ... å¤§é‡ã®çŠ¶æ…‹ç®¡ç†ã‚³ãƒ¼ãƒ‰

// After
import { useGameState } from './hooks/useGameState';

const { state, actions } = useGameState(initialGame);
const { homeTeam, awayTeam, currentInning, isTop } = state;
```

**æœŸå¾…åŠ¹æœ**:
- âœ… App.tsxã‹ã‚‰300è¡Œå‰Šæ¸›
- âœ… çŠ¶æ…‹ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸90%+
- âœ… å†åˆ©ç”¨å¯èƒ½ãªHookï¼ˆä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚ä½¿ç”¨å¯èƒ½ï¼‰

---

#### å®Ÿè£…1-2: useScoreCalculationï¼ˆ0.3æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/hooks/useScoreCalculation.ts`

```typescript
import { useMemo } from 'react';
import { Team, RunEvent } from '../types';

export interface ScoreData {
  totalScore: number;
  inningScores: number[];
  hits: number;
  errors: number;
}

export interface UseScoreCalculationReturn {
  homeScore: ScoreData;
  awayScore: ScoreData;
  calculateInningScore: (team: Team, inning: number) => number;
}

/**
 * ã‚¹ã‚³ã‚¢è¨ˆç®—ã‚’è¡Œã†ã‚«ã‚¹ã‚¿ãƒ Hook
 *
 * - RunEvent ã¯ runCount ã‚’ç”¨ã„ã‚‹
 * - å…ˆæ”»(away)ã¯è¡¨(isTop: true)ã€å¾Œæ”»(home)ã¯è£(isTop: false)
 */
export const useScoreCalculation = (
  homeTeam: Team,
  awayTeam: Team,
  runEvents: RunEvent[]
): UseScoreCalculationReturn => {
  // åˆè¨ˆã‚¹ã‚³ã‚¢ = AtBat.rbi åˆè¨ˆ + RunEvent.runCount åˆè¨ˆ
  const calculateTotalScore = (team: Team, isAwayTeam: boolean): number => {
    const atBatTotal = team.atBats.reduce((sum, ab) => sum + (ab.rbi || 0), 0);
    const runEventTotal = runEvents
      .filter((e) => e.isTop === isAwayTeam)
      .reduce((sum, e) => sum + (e.runCount || 0), 0);
    return atBatTotal + runEventTotal;
  };

  const calculateInningScores = (
    team: Team,
    isAwayTeam: boolean,
    maxInning: number
  ): number[] => {
    const scores: number[] = [];
    for (let i = 1; i <= maxInning; i++) {
      const atBatInning = team.atBats
        .filter((ab) => ab.inning === i)
        .reduce((sum, ab) => sum + (ab.rbi || 0), 0);
      const runEventInning = runEvents
        .filter((e) => e.inning === i && e.isTop === isAwayTeam)
        .reduce((sum, e) => sum + (e.runCount || 0), 0);
      scores.push(atBatInning + runEventInning);
    }
    return scores;
  };

  const calculateHits = (team: Team): number => {
    // ãƒ’ãƒƒãƒˆã¯ IH/LH/CH/RH/2B/3B/HR ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
    const hitResults = ['IH', 'LH', 'CH', 'RH', '2B', '3B', 'HR'];
    return team.atBats.filter((ab) => hitResults.includes(ab.result)).length;
  };

  const calculateErrors = (team: Team): number => {
    return team.atBats.filter((ab) => ab.result === 'E').length;
  };

  const maxInning = Math.max(...runEvents.map((e) => e.inning), 7);

  const homeScore = useMemo<ScoreData>(() => ({
    totalScore: calculateTotalScore(homeTeam, false),
    inningScores: calculateInningScores(homeTeam, false, maxInning),
    hits: calculateHits(homeTeam),
    errors: calculateErrors(homeTeam),
  }), [homeTeam, runEvents, maxInning]);

  const awayScore = useMemo<ScoreData>(() => ({
    totalScore: calculateTotalScore(awayTeam, true),
    inningScores: calculateInningScores(awayTeam, true, maxInning),
    hits: calculateHits(awayTeam),
    errors: calculateErrors(awayTeam),
  }), [awayTeam, runEvents, maxInning]);

  const calculateInningScore = (team: Team, inning: number): number => {
    const isAwayTeam = team === awayTeam;
    const atBatInning = team.atBats
      .filter((ab) => ab.inning === inning)
      .reduce((sum, ab) => sum + (ab.rbi || 0), 0);
    const runEventInning = runEvents
      .filter((e) => e.inning === inning && e.isTop === isAwayTeam)
      .reduce((sum, e) => sum + (e.runCount || 0), 0);
    return atBatInning + runEventInning;
  };

  return { homeScore, awayScore, calculateInningScore };
};
```

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/hooks/__tests__/useScoreCalculation.test.ts`

```typescript
import { renderHook } from '@testing-library/react';
import { useScoreCalculation } from '../useScoreCalculation';
import { Team, RunEvent } from '../../types';

describe('useScoreCalculation', () => {
  const mockHomeTeam: Team = {
    id: 'home',
    name: 'ãƒ›ãƒ¼ã‚¯ã‚¹',
    players: [],
    atBats: [
      { id: 'ab1', playerId: '1', result: 'IH', inning: 1, rbi: 1, isOut: false },
      { id: 'ab2', playerId: '2', result: 'HR', inning: 2, rbi: 1, isOut: false },
      { id: 'ab3', playerId: '3', result: 'SO', inning: 3, rbi: 0, isOut: true },
    ],
  };

  const mockAwayTeam: Team = {
    id: 'away',
    name: 'ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹',
    players: [],
    atBats: [
      { id: 'ab4', playerId: '1', result: '2B', inning: 1, rbi: 0, isOut: false },
      { id: 'ab5', playerId: '2', result: 'E', inning: 2, rbi: 0, isOut: false },
    ],
  };

  const mockRunEvents: RunEvent[] = [
    { id: 're1', inning: 1, isTop: false, runType: 'ãã®ä»–', runCount: 0, timestamp: Date.now() },
    { id: 're2', inning: 2, isTop: false, runType: 'ãã®ä»–', runCount: 3, timestamp: Date.now() },
    { id: 're3', inning: 1, isTop: true,  runType: 'ãã®ä»–', runCount: 2, timestamp: Date.now() },
  ];

  test('åˆè¨ˆã‚¹ã‚³ã‚¢ã‚’æ­£ã—ãè¨ˆç®—ã™ã‚‹', () => {
    const { result } = renderHook(() =>
      useScoreCalculation(mockHomeTeam, mockAwayTeam, mockRunEvents)
    );

    expect(result.current.homeScore.totalScore).toBe(1 /* rbi */ + 3 /* run */);
    expect(result.current.awayScore.totalScore).toBe(2 /* run */);
  });

  test('ã‚¤ãƒ‹ãƒ³ã‚°åˆ¥ã‚¹ã‚³ã‚¢ã‚’æ­£ã—ãè¨ˆç®—ã™ã‚‹', () => {
    const { result } = renderHook(() =>
      useScoreCalculation(mockHomeTeam, mockAwayTeam, mockRunEvents)
    );
    expect(result.current.homeScore.inningScores[0]).toBe(1);
    expect(result.current.homeScore.inningScores[1]).toBe(1 + 3);
    expect(result.current.awayScore.inningScores[0]).toBe(2);
  });

  test('ãƒ’ãƒƒãƒˆæ•°ã¨ã‚¨ãƒ©ãƒ¼æ•°ã‚’è¨ˆç®—ã™ã‚‹', () => {
    const { result } = renderHook(() =>
      useScoreCalculation(mockHomeTeam, mockAwayTeam, mockRunEvents)
    );
    expect(result.current.homeScore.hits).toBe(2); // IH, HR
    expect(result.current.awayScore.hits).toBe(1); // 2B
    expect(result.current.awayScore.errors).toBe(1); // E
  });
});
```

**æœŸå¾…åŠ¹æœ**:
- âœ… App.tsxã‹ã‚‰200è¡Œå‰Šæ¸›
- âœ… ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸95%+
- âœ… useMemoã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

---

#### å®Ÿè£…1-3: ãã®ä»–ã®Hooksï¼ˆ0.7æ—¥ï¼‰

åŒæ§˜ã«ä»¥ä¸‹ã®Hooksã‚’å®Ÿè£…ï¼š

1. **useTeamManagement.ts** (0.3æ—¥)
   - ãƒãƒ¼ãƒ ä½œæˆã€ç·¨é›†ã€å‰Šé™¤
   - é¸æ‰‹è¿½åŠ ã€å‰Šé™¤ã€ä¸¦ã³æ›¿ãˆ
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

2. **useInningControl.ts** (0.2æ—¥)
   - ã‚¤ãƒ‹ãƒ³ã‚°é€²è¡Œãƒ­ã‚¸ãƒƒã‚¯
   - æ”»å®ˆäº¤ä»£åˆ¤å®š
   - è©¦åˆçµ‚äº†åˆ¤å®š

3. **useAtBatHistory.ts** (0.2æ—¥)
   - æ‰“å¸­å±¥æ­´ã®ç®¡ç†
   - ç·¨é›†ã€å‰Šé™¤æ©Ÿèƒ½
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

---

### Step 5a-2: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚µãƒ¼ãƒ“ã‚¹å±¤åˆ†é›¢ï¼ˆ1.0æ—¥ï¼‰

#### å¯¾è±¡ãƒ­ã‚¸ãƒƒã‚¯ã®ç‰¹å®š

| ã‚µãƒ¼ãƒ“ã‚¹å | è²¬å‹™ | è¡Œæ•° | å·¥æ•° |
|-----------|------|------|------|
| ScoreCalculator | ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆç´”ç²‹é–¢æ•°ï¼‰ | ~150 | 0.3æ—¥ |
| InningManager | ã‚¤ãƒ‹ãƒ³ã‚°é€²è¡Œåˆ¶å¾¡ | ~100 | 0.2æ—¥ |
| AtBatValidator | æ‰“å¸­ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ | ~80 | 0.2æ—¥ |
| GameSerializer | è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º | ~100 | 0.3æ—¥ |

#### å®Ÿè£…2-1: ScoreCalculatorï¼ˆ0.3æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/ScoreCalculator.ts`

```typescript
import { RunEvent, AtBat } from '../types';

/**
 * ã‚¹ã‚³ã‚¢è¨ˆç®—ã‚’è¡Œã†ç´”ç²‹é–¢æ•°ç¾¤
 */
export class ScoreCalculator {
  static calculateInningScore(
    runEvents: RunEvent[],
    inning: number,
    isTop: boolean
  ): number {
    return runEvents
      .filter((e) => e.inning === inning && e.isTop === isTop)
      .reduce((sum, e) => sum + (e.runCount || 0), 0);
  }

  static calculateTotalRunEvents(
    runEvents: RunEvent[],
    isTop: boolean
  ): number {
    return runEvents
      .filter((e) => e.isTop === isTop)
      .reduce((sum, e) => sum + (e.runCount || 0), 0);
  }

  static calculateHits(atBats: AtBat[]): number {
    const hitResults = ['IH', 'LH', 'CH', 'RH', '2B', '3B', 'HR'];
    return atBats.filter((ab) => hitResults.includes(ab.result)).length;
  }

  static calculateBattingAverage(atBats: AtBat[]): number {
    const validAtBats = atBats.filter(
      (ab) => !['BB', 'HBP', 'SAC', 'SF'].includes(ab.result)
    );
    if (validAtBats.length === 0) return 0;
    const hits = this.calculateHits(validAtBats);
    return hits / validAtBats.length;
  }

  static calculateSluggingPercentage(atBats: AtBat[]): number {
    const validAtBats = atBats.filter(
      (ab) => !['BB', 'HBP', 'SAC', 'SF'].includes(ab.result)
    );
    if (validAtBats.length === 0) return 0;
    const totalBases = validAtBats.reduce((sum, ab) => {
      switch (ab.result) {
        case 'IH':
        case 'LH':
        case 'CH':
        case 'RH':
          return sum + 1;
        case '2B':
          return sum + 2;
        case '3B':
          return sum + 3;
        case 'HR':
          return sum + 4;
        default:
          return sum;
      }
    }, 0);
    return totalBases / validAtBats.length;
  }

  static calculateOnBasePercentage(atBats: AtBat[]): number {
    if (atBats.length === 0) return 0;
    const timesOnBase = atBats.filter((ab) =>
      ['IH', 'LH', 'CH', 'RH', '2B', '3B', 'HR', 'BB', 'HBP'].includes(ab.result)
    ).length;
    return timesOnBase / atBats.length;
  }

  static calculateOPS(atBats: AtBat[]): number {
    const obp = this.calculateOnBasePercentage(atBats);
    const slg = this.calculateSluggingPercentage(atBats);
    return obp + slg;
  }

  static determineWinner(
    homeScore: number,
    awayScore: number
  ): 'home' | 'away' | 'tie' {
    if (homeScore > awayScore) return 'home';
    if (awayScore > homeScore) return 'away';
    return 'tie';
  }
}
```

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/__tests__/ScoreCalculator.test.ts`

```typescript
import { ScoreCalculator } from '../ScoreCalculator';
import { AtBat, RunEvent } from '../../types';

describe('ScoreCalculator', () => {
  describe('calculateInningScore', () => {
    test('æŒ‡å®šã‚¤ãƒ‹ãƒ³ã‚°ã®ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ã™ã‚‹', () => {
      const runEvents: RunEvent[] = [
        { id: '1', inning: 1, isTop: true,  runType: 'ãã®ä»–', runCount: 2, timestamp: Date.now() },
        { id: '2', inning: 1, isTop: false, runType: 'ãã®ä»–', runCount: 1, timestamp: Date.now() },
        { id: '3', inning: 2, isTop: true,  runType: 'ãã®ä»–', runCount: 3, timestamp: Date.now() },
      ];

      expect(ScoreCalculator.calculateInningScore(runEvents, 1, true)).toBe(2);
      expect(ScoreCalculator.calculateInningScore(runEvents, 1, false)).toBe(1);
      expect(ScoreCalculator.calculateInningScore(runEvents, 2, true)).toBe(3);
    });

    test('è©²å½“ã‚¤ãƒ‹ãƒ³ã‚°ãŒãªã„å ´åˆã¯0ã‚’è¿”ã™', () => {
      const runEvents: RunEvent[] = [];
      expect(ScoreCalculator.calculateInningScore(runEvents, 1, true)).toBe(0);
    });
  });

  describe('calculateBattingAverage', () => {
    test('æ‰“ç‡ã‚’æ­£ã—ãè¨ˆç®—ã™ã‚‹', () => {
      const atBats: AtBat[] = [
        { id: 'a1', playerId: 'p1', result: 'IH', inning: 1, rbi: 0, isOut: false },
        { id: 'a2', playerId: 'p2', result: 'SO', inning: 1, rbi: 0, isOut: true },
        { id: 'a3', playerId: 'p3', result: '2B', inning: 1, rbi: 0, isOut: false },
        { id: 'a4', playerId: 'p4', result: 'GO_SS', inning: 1, rbi: 0, isOut: true },
      ];
      expect(ScoreCalculator.calculateBattingAverage(atBats)).toBe(0.5);
    });

    test('å››çƒã¯æ‰“æ•°ã«å«ã‚ãªã„', () => {
      const atBats: AtBat[] = [
        { id: 'a1', playerId: 'p1', result: 'IH', inning: 1, rbi: 0, isOut: false },
        { id: 'a2', playerId: 'p2', result: 'BB', inning: 1, rbi: 0, isOut: false },
        { id: 'a3', playerId: 'p3', result: 'SO', inning: 1, rbi: 0, isOut: true },
      ];
      expect(ScoreCalculator.calculateBattingAverage(atBats)).toBe(0.5);
    });
  });

  describe('calculateOPS', () => {
    test('OPSã‚’æ­£ã—ãè¨ˆç®—ã™ã‚‹', () => {
      const atBats: AtBat[] = [
        { id: 'a1', playerId: 'p1', result: 'IH', inning: 1, rbi: 0, isOut: false },
        { id: 'a2', playerId: 'p2', result: 'HR', inning: 1, rbi: 0, isOut: false },
        { id: 'a3', playerId: 'p3', result: 'SO', inning: 1, rbi: 0, isOut: true },
        { id: 'a4', playerId: 'p4', result: 'BB', inning: 1, rbi: 0, isOut: false },
      ];
      const ops = ScoreCalculator.calculateOPS(atBats);
      expect(ops).toBeGreaterThan(0);
    });
  });

  describe('determineWinner', () => {
    test('ãƒ›ãƒ¼ãƒ ã®å‹åˆ©ã‚’æ­£ã—ãåˆ¤å®šã™ã‚‹', () => {
      expect(ScoreCalculator.determineWinner(5, 3)).toBe('home');
    });
    test('ã‚¢ã‚¦ã‚§ã‚¤ã®å‹åˆ©ã‚’æ­£ã—ãåˆ¤å®šã™ã‚‹', () => {
      expect(ScoreCalculator.determineWinner(2, 7)).toBe('away');
    });
    test('å¼•ãåˆ†ã‘ã‚’æ­£ã—ãåˆ¤å®šã™ã‚‹', () => {
      expect(ScoreCalculator.determineWinner(4, 4)).toBe('tie');
    });
  });
});
```

**æœŸå¾…åŠ¹æœ**:
- âœ… ç´”ç²‹é–¢æ•°ã®ãŸã‚ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸100%é”æˆå¯èƒ½
- âœ… å†åˆ©ç”¨æ€§ãŒé«˜ã„
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“

---

#### å®Ÿè£…2-2: ãã®ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ0.7æ—¥ï¼‰

åŒæ§˜ã«ä»¥ä¸‹ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å®Ÿè£…ï¼š

1. **InningManager.ts** (0.2æ—¥)
2. **AtBatValidator.ts** (0.2æ—¥)
3. **GameSerializer.ts** (0.3æ—¥)

---

### Step 5a-3: App.tsxã®çµ±åˆã¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆ0.5æ—¥ï¼‰

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«**: `src/App.tsx`

```typescript
// Before: 1,707è¡Œã®å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«

// After: Hooksã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã—ãŸç°¡æ½”ãªå®Ÿè£…
import React from 'react';
import { useGameState } from './hooks/useGameState';
import { useScoreCalculation } from './hooks/useScoreCalculation';
import { useTeamManagement } from './hooks/useTeamManagement';
import { ScoreCalculator } from './services/ScoreCalculator';

const App: React.FC = () => {
  // çŠ¶æ…‹ç®¡ç†ã‚’Hooksã«å§”è­²
  const { state, actions } = useGameState();
  const { homeScore, awayScore } = useScoreCalculation(
    state.homeTeam,
    state.awayTeam,
    state.runEvents
  );
  const teamManagement = useTeamManagement();

  // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚µãƒ¼ãƒ“ã‚¹å±¤ã«å§”è­²
  const winner = ScoreCalculator.determineWinner(
    homeScore.totalScore,
    awayScore.totalScore
  );

  // UIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«é›†ä¸­
  return (
    <div>
      {/* ... UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ */}
    </div>
  );
};

export default App;

// ç›®æ¨™: 500è¡Œä»¥ä¸‹
```

**App.tsxã®ãƒ†ã‚¹ãƒˆ**: `src/App.test.tsx`

```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import App from './App';

describe('App', () => {
  test('æ­£å¸¸ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹', () => {
    render(<App />);
    expect(screen.getByText(/é‡çƒã‚¹ã‚³ã‚¢/i)).toBeInTheDocument();
  });

  test('è©¦åˆã‚’ä½œæˆã§ãã‚‹', async () => {
    render(<App />);
    
    // è©¦åˆä½œæˆãƒ•ãƒ­ãƒ¼
    fireEvent.click(screen.getByText('æ–°ã—ã„è©¦åˆ'));
    // ... ã•ã‚‰ãªã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
  });

  // Hooksã¨ã‚µãƒ¼ãƒ“ã‚¹å±¤ãŒæ—¢ã«ãƒ†ã‚¹ãƒˆæ¸ˆã¿ãªã®ã§
  // Appã®ãƒ†ã‚¹ãƒˆã¯çµ±åˆãƒ†ã‚¹ãƒˆçš„ãªè¦³ç‚¹ã§æœ€å°é™ã«
});
```

---

### Phase 5aå—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] useGameStateãŒå®Ÿè£…ã•ã‚Œã€ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸90%ä»¥ä¸Š
- [ ] useScoreCalculationãŒå®Ÿè£…ã•ã‚Œã€ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸95%ä»¥ä¸Š
- [ ] ScoreCalculatorã‚µãƒ¼ãƒ“ã‚¹ãŒå®Ÿè£…ã•ã‚Œã€ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸100%
- [ ] App.tsxãŒ500è¡Œä»¥ä¸‹ã«å‰Šæ¸›
- [ ] å…¨ã¦ã®æ—¢å­˜æ©Ÿèƒ½ãŒæ­£å¸¸å‹•ä½œ
- [ ] å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒ50%ä»¥ä¸Šã«å‘ä¸Š
- [ ] **CIã®ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ã‚’30%ã«æˆ»ã™**

**å·¥æ•°**: 3.0æ—¥

---

## ğŸ”’ Phase 5b: Firebaseä¾å­˜ã®æŠ½è±¡åŒ–ï¼ˆ2.0æ—¥ï¼‰

### ç›®çš„

Firebaseç›´æ¥ä¾å­˜ã‚’æŠ½è±¡åŒ–ã—ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ éä¾å­˜æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚

### å®Ÿè£…æˆ¦ç•¥ï¼šRepositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã®å°å…¥

---

### Step 5b-1: Repositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ï¼ˆ0.3æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/repositories/interfaces/IGameRepository.ts`

```typescript
import { Game } from '../../types';

/**
 * è©¦åˆãƒ‡ãƒ¼ã‚¿ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
 * 
 * å®Ÿè£…:
 * - FirebaseGameRepository (æœ¬ç•ªç’°å¢ƒ)
 * - MockGameRepository (ãƒ†ã‚¹ãƒˆç’°å¢ƒ)
 * - LocalStorageGameRepository (ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç’°å¢ƒ)
 */
export interface IGameRepository {
  /**
   * è©¦åˆã‚’ä¿å­˜
   * 
   * @param game - è©¦åˆãƒ‡ãƒ¼ã‚¿
   * @param userId - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
   * @returns ä¿å­˜ã•ã‚ŒãŸè©¦åˆã®ID
   */
  save(game: Game, userId: string): Promise<string>;

  /**
   * è©¦åˆã‚’å–å¾—
   * 
   * @param gameId - è©¦åˆID
   * @returns è©¦åˆãƒ‡ãƒ¼ã‚¿ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯nullï¼‰
   */
  load(gameId: string): Promise<Game | null>;

  /**
   * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©¦åˆä¸€è¦§ã‚’å–å¾—
   * 
   * @param userId - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
   * @param options - ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³
   * @returns è©¦åˆãƒ‡ãƒ¼ã‚¿ã®é…åˆ—
   */
  list(userId: string, options?: ListOptions): Promise<Game[]>;

  /**
   * è©¦åˆã‚’å‰Šé™¤
   * 
   * @param gameId - è©¦åˆID
   */
  delete(gameId: string): Promise<void>;

  /**
   * è©¦åˆã‚’æ›´æ–°
   * 
   * @param gameId - è©¦åˆID
   * @param game - æ›´æ–°ã™ã‚‹è©¦åˆãƒ‡ãƒ¼ã‚¿
   */
  update(gameId: string, game: Partial<Game>): Promise<void>;
}

export interface ListOptions {
  limit?: number;
  orderBy?: 'date' | 'createdAt' | 'updatedAt';
  orderDirection?: 'asc' | 'desc';
  startAfter?: string; // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç”¨
}
```

**ãã®ä»–ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:

```typescript
// src/repositories/interfaces/ITeamRepository.ts
export interface ITeamRepository {
  save(team: Team, userId: string): Promise<string>;
  load(teamId: string): Promise<Team | null>;
  list(userId: string): Promise<Team[]>;
  delete(teamId: string): Promise<void>;
  update(teamId: string, team: Partial<Team>): Promise<void>;
}

// src/repositories/interfaces/IStatsRepository.ts
export interface IStatsRepository {
  savePlayerStats(playerId: string, stats: PlayerStats): Promise<void>;
  loadPlayerStats(playerId: string): Promise<PlayerStats | null>;
  loadTeamStats(teamId: string): Promise<TeamStats | null>;
}
```

---

### Step 5b-2: Firebaseå®Ÿè£…ï¼ˆ0.5æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/repositories/implementations/FirebaseGameRepository.ts`

```typescript
import { Firestore, collection, doc, getDoc, getDocs, setDoc, deleteDoc, query, where, orderBy, limit as fbLimit } from 'firebase/firestore';
import { IGameRepository, ListOptions } from '../interfaces/IGameRepository';
import { Game } from '../../types';

export class FirebaseGameRepository implements IGameRepository {
  private firestore: Firestore;
  private collectionName = 'games';

  constructor(firestore: Firestore) {
    this.firestore = firestore;
  }

  async save(game: Game, userId: string): Promise<string> {
    const gamesRef = collection(this.firestore, this.collectionName);
    const newDocRef = doc(gamesRef);
    
    const gameData = {
      ...game,
      userId,
      createdAt: Date.now(),
      updatedAt: Date.now(),
    };

    await setDoc(newDocRef, gameData);
    return newDocRef.id;
  }

  async load(gameId: string): Promise<Game | null> {
    const docRef = doc(this.firestore, this.collectionName, gameId);
    const docSnap = await getDoc(docRef);

    if (!docSnap.exists()) {
      return null;
    }

    return { id: docSnap.id, ...docSnap.data() } as Game;
  }

  async list(userId: string, options: ListOptions = {}): Promise<Game[]> {
    const {
      limit = 50,
      orderBy: orderField = 'createdAt',
      orderDirection = 'desc',
    } = options;

    const gamesRef = collection(this.firestore, this.collectionName);
    const q = query(
      gamesRef,
      where('userId', '==', userId),
      orderBy(orderField, orderDirection),
      fbLimit(limit)
    );

    const querySnapshot = await getDocs(q);
    return querySnapshot.docs.map(doc => ({
      id: doc.id,
      ...doc.data(),
    } as Game));
  }

  async delete(gameId: string): Promise<void> {
    const docRef = doc(this.firestore, this.collectionName, gameId);
    await deleteDoc(docRef);
  }

  async update(gameId: string, game: Partial<Game>): Promise<void> {
    const docRef = doc(this.firestore, this.collectionName, gameId);
    await setDoc(docRef, {
      ...game,
      updatedAt: Date.now(),
    }, { merge: true });
  }
}
```

---

### Step 5b-3: Mockå®Ÿè£…ï¼ˆ0.3æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/repositories/implementations/MockGameRepository.ts`

```typescript
import { IGameRepository, ListOptions } from '../interfaces/IGameRepository';
import { Game } from '../../types';

/**
 * ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒª
 * 
 * ç‰¹å¾´:
 * - ãƒ¡ãƒ¢ãƒªå†…ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†
 * - Firebase Emulatorä¸è¦
 * - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé€Ÿåº¦ãŒé€Ÿã„ï¼ˆ50å€ä»¥ä¸Šï¼‰
 */
export class MockGameRepository implements IGameRepository {
  private storage: Map<string, Game> = new Map();
  private idCounter = 0;

  async save(game: Game, userId: string): Promise<string> {
    const id = `mock-game-${++this.idCounter}`;
    const gameData = {
      ...game,
      id,
      userId,
      createdAt: Date.now(),
      updatedAt: Date.now(),
    };

    this.storage.set(id, gameData);
    
    // éåŒæœŸå‹•ä½œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
    await this.delay(10);
    
    return id;
  }

  async load(gameId: string): Promise<Game | null> {
    await this.delay(10);
    return this.storage.get(gameId) || null;
  }

  async list(userId: string, options: ListOptions = {}): Promise<Game[]> {
    await this.delay(10);
    
    let games = Array.from(this.storage.values())
      .filter(game => game.userId === userId);

    // ã‚½ãƒ¼ãƒˆ
    const { orderBy = 'createdAt', orderDirection = 'desc' } = options;
    games.sort((a, b) => {
      const aVal = a[orderBy] || 0;
      const bVal = b[orderBy] || 0;
      return orderDirection === 'asc' ? aVal - bVal : bVal - aVal;
    });

    // ãƒªãƒŸãƒƒãƒˆ
    if (options.limit) {
      games = games.slice(0, options.limit);
    }

    return games;
  }

  async delete(gameId: string): Promise<void> {
    await this.delay(10);
    this.storage.delete(gameId);
  }

  async update(gameId: string, game: Partial<Game>): Promise<void> {
    await this.delay(10);
    const existing = this.storage.get(gameId);
    
    if (existing) {
      this.storage.set(gameId, {
        ...existing,
        ...game,
        updatedAt: Date.now(),
      });
    }
  }

  // ãƒ†ã‚¹ãƒˆç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
  clear(): void {
    this.storage.clear();
    this.idCounter = 0;
  }

  size(): number {
    return this.storage.size;
  }

  private delay(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}
```

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/repositories/__tests__/MockGameRepository.test.ts`

```typescript
import { MockGameRepository } from '../implementations/MockGameRepository';
import { Game } from '../../types';

describe('MockGameRepository', () => {
  let repository: MockGameRepository;

  beforeEach(() => {
    repository = new MockGameRepository();
  });

  afterEach(() => {
    repository.clear();
  });

  test('è©¦åˆã‚’ä¿å­˜ã§ãã‚‹', async () => {
    const game: Game = {
      homeTeam: { name: 'ãƒ›ãƒ¼ã‚¯ã‚¹', players: [], atBats: [] },
      awayTeam: { name: 'ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹', players: [], atBats: [] },
      date: Date.now(),
    };

    const gameId = await repository.save(game, 'user123');

    expect(gameId).toMatch(/^mock-game-\d+$/);
    expect(repository.size()).toBe(1);
  });

  test('ä¿å­˜ã—ãŸè©¦åˆã‚’å–å¾—ã§ãã‚‹', async () => {
    const game: Game = {
      homeTeam: { name: 'ãƒ›ãƒ¼ã‚¯ã‚¹', players: [], atBats: [] },
      awayTeam: { name: 'ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹', players: [], atBats: [] },
      date: Date.now(),
    };

    const gameId = await repository.save(game, 'user123');
    const loaded = await repository.load(gameId);

    expect(loaded).toBeDefined();
    expect(loaded?.homeTeam.name).toBe('ãƒ›ãƒ¼ã‚¯ã‚¹');
  });

  test('å­˜åœ¨ã—ãªã„è©¦åˆã‚’å–å¾—ã™ã‚‹ã¨nullã‚’è¿”ã™', async () => {
    const loaded = await repository.load('non-existent-id');
    expect(loaded).toBeNull();
  });

  test('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©¦åˆä¸€è¦§ã‚’å–å¾—ã§ãã‚‹', async () => {
    const game1: Game = { homeTeam: { name: 'A' }, awayTeam: { name: 'B' }, date: Date.now() };
    const game2: Game = { homeTeam: { name: 'C' }, awayTeam: { name: 'D' }, date: Date.now() };

    await repository.save(game1, 'user123');
    await repository.save(game2, 'user123');
    await repository.save(game1, 'user456'); // åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼

    const games = await repository.list('user123');

    expect(games).toHaveLength(2);
  });

  test('ãƒªãƒŸãƒƒãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæ©Ÿèƒ½ã™ã‚‹', async () => {
    for (let i = 0; i < 10; i++) {
      await repository.save(
        { homeTeam: { name: `Team${i}` }, awayTeam: { name: 'B' }, date: Date.now() },
        'user123'
      );
    }

    const games = await repository.list('user123', { limit: 5 });

    expect(games).toHaveLength(5);
  });

  test('è©¦åˆã‚’å‰Šé™¤ã§ãã‚‹', async () => {
    const game: Game = { homeTeam: { name: 'A' }, awayTeam: { name: 'B' }, date: Date.now() };
    const gameId = await repository.save(game, 'user123');

    await repository.delete(gameId);

    const loaded = await repository.load(gameId);
    expect(loaded).toBeNull();
  });

  test('è©¦åˆã‚’æ›´æ–°ã§ãã‚‹', async () => {
    const game: Game = { homeTeam: { name: 'A' }, awayTeam: { name: 'B' }, date: Date.now() };
    const gameId = await repository.save(game, 'user123');

    await repository.update(gameId, {
      homeTeam: { name: 'Updated Team', players: [], atBats: [] },
    });

    const updated = await repository.load(gameId);
    expect(updated?.homeTeam.name).toBe('Updated Team');
  });
});
```

**æœŸå¾…åŠ¹æœ**:
- âœ… ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“: 30ç§’ â†’ 0.5ç§’ï¼ˆ60å€é«˜é€ŸåŒ–ï¼‰
- âœ… Firebase Emulatorä¸è¦
- âœ… ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸: Firebaseç³»ã‚µãƒ¼ãƒ“ã‚¹ 0% â†’ 90%+

---

### Step 5b-4: Dependency Injectionå®Ÿè£…ï¼ˆ0.5æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `src/contexts/RepositoryContext.tsx`

```typescript
import React, { createContext, useContext, useMemo, ReactNode } from 'react';
import { Firestore } from 'firebase/firestore';
import { IGameRepository } from '../repositories/interfaces/IGameRepository';
import { ITeamRepository } from '../repositories/interfaces/ITeamRepository';
import { IStatsRepository } from '../repositories/interfaces/IStatsRepository';
import { FirebaseGameRepository } from '../repositories/implementations/FirebaseGameRepository';
import { FirebaseTeamRepository } from '../repositories/implementations/FirebaseTeamRepository';
import { FirebaseStatsRepository } from '../repositories/implementations/FirebaseStatsRepository';

interface Repositories {
  gameRepository: IGameRepository;
  teamRepository: ITeamRepository;
  statsRepository: IStatsRepository;
}

const RepositoryContext = createContext<Repositories | null>(null);

interface RepositoryProviderProps {
  children: ReactNode;
  firestore?: Firestore;
  repositories?: Partial<Repositories>;
}

/**
 * Repositoryã®ä¾å­˜æ³¨å…¥ã‚’è¡Œã†Provider
 * 
 * ä½¿ç”¨ä¾‹:
 * ```tsx
 * // æœ¬ç•ªç’°å¢ƒ
 * <RepositoryProvider firestore={firestore}>
 *   <App />
 * </RepositoryProvider>
 * 
 * // ãƒ†ã‚¹ãƒˆç’°å¢ƒ
 * <RepositoryProvider repositories={{ gameRepository: new MockGameRepository() }}>
 *   <App />
 * </RepositoryProvider>
 * ```
 */
export const RepositoryProvider: React.FC<RepositoryProviderProps> = ({
  children,
  firestore,
  repositories,
}) => {
  const defaultRepositories = useMemo<Repositories>(() => {
    if (repositories?.gameRepository && repositories?.teamRepository && repositories?.statsRepository) {
      return repositories as Repositories;
    }

    if (!firestore) {
      throw new Error('RepositoryProvider requires either firestore or repositories prop');
    }

    return {
      gameRepository: repositories?.gameRepository || new FirebaseGameRepository(firestore),
      teamRepository: repositories?.teamRepository || new FirebaseTeamRepository(firestore),
      statsRepository: repositories?.statsRepository || new FirebaseStatsRepository(firestore),
    };
  }, [firestore, repositories]);

  return (
    <RepositoryContext.Provider value={defaultRepositories}>
      {children}
    </RepositoryContext.Provider>
  );
};

/**
 * GameRepositoryã‚’å–å¾—ã™ã‚‹Hook
 */
export const useGameRepository = (): IGameRepository => {
  const context = useContext(RepositoryContext);
  if (!context) {
    throw new Error('useGameRepository must be used within RepositoryProvider');
  }
  return context.gameRepository;
};

/**
 * TeamRepositoryã‚’å–å¾—ã™ã‚‹Hook
 */
export const useTeamRepository = (): ITeamRepository => {
  const context = useContext(RepositoryContext);
  if (!context) {
    throw new Error('useTeamRepository must be used within RepositoryProvider');
  }
  return context.teamRepository;
};

/**
 * StatsRepositoryã‚’å–å¾—ã™ã‚‹Hook
 */
export const useStatsRepository = (): IStatsRepository => {
  const context = useContext(RepositoryContext);
  if (!context) {
    throw new Error('useStatsRepository must be used within RepositoryProvider');
  }
  return context.statsRepository;
};
```

---

### Step 5b-5: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç§»è¡Œï¼ˆ0.4æ—¥ï¼‰

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«**: `src/App.tsx`ï¼ˆç¾çŠ¶ `AuthProvider` ã‚’å†…åŒ…ã—ã¦ã„ã‚‹ãŸã‚ã€ã¾ãšã¯ `RepositoryProvider` ã‚’ `App` å†…ã«è¿½åŠ ã™ã‚‹ã®ãŒå½±éŸ¿æœ€å°ï¼‰

```typescript
// App.tsx å†…ï¼ˆThemeProvider/CssBaseline ã®ä¸‹ï¼‰ã« RepositoryProvider ã‚’è¿½åŠ 
import { firestore } from './firebase/config';
import { RepositoryProvider } from './contexts/RepositoryContext';

return (
  <ThemeProvider theme={theme}>
    <CssBaseline />
    <AuthProvider>
      <RepositoryProvider firestore={firestore}>
        <MainApp toggleColorMode={toggleColorMode} mode={mode} />
      </RepositoryProvider>
    </AuthProvider>
  </ThemeProvider>
);
```

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«**: `src/App.tsx`ï¼ˆã¾ãŸã¯ä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰

```typescript
// Before
import { saveGame, loadGame } from './firebase/gameService';

const handleSave = async () => {
  const gameId = await saveGame(game, user.uid);
};

// After
import { useGameRepository } from './contexts/RepositoryContext';

const gameRepository = useGameRepository();

const handleSave = async () => {
  const gameId = await gameRepository.save(game, user.uid);
};
```

**ãƒ†ã‚¹ãƒˆã§ã®ä½¿ç”¨**:

```typescript
// src/App.test.tsx
import { render, screen } from '@testing-library/react';
import { RepositoryProvider } from './contexts/RepositoryContext';
import { MockGameRepository } from './repositories/implementations/MockGameRepository';
import App from './App';

describe('App with MockRepository', () => {
  test('è©¦åˆã‚’ä¿å­˜ã§ãã‚‹', async () => {
    const mockRepo = new MockGameRepository();

    render(
      <RepositoryProvider repositories={{ gameRepository: mockRepo }}>
        <App />
      </RepositoryProvider>
    );

    // Firebaseä¸è¦ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¯èƒ½ï¼
    // ... ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
  });
});
```

---

### Phase 5bå—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] IGameRepositoryã€ITeamRepositoryã€IStatsRepositoryã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©å®Œäº†
- [ ] FirebaseGameRepositoryã®å®Ÿè£…å®Œäº†
- [ ] MockGameRepositoryã®å®Ÿè£…å®Œäº†ã€ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸95%ä»¥ä¸Š
- [ ] RepositoryProviderã®å®Ÿè£…å®Œäº†
- [ ] æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãŒæ–°ã—ã„RepositoryçµŒç”±ã«ç§»è¡Œ
- [ ] å…¨ãƒ†ã‚¹ãƒˆãŒMockRepositoryã§å®Ÿè¡Œå¯èƒ½
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ãŒ50%ä»¥ä¸ŠçŸ­ç¸®

**å·¥æ•°**: 2.0æ—¥

---

## ğŸ§ª Phase 5c: E2Eãƒ†ã‚¹ãƒˆåŸºç›¤ã®æ§‹ç¯‰ï¼ˆ2.0æ—¥ï¼‰

### ç›®çš„

Playwrightã‚’ä½¿ç”¨ã—ãŸã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã—ã€ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ã®è‡ªå‹•æ¤œè¨¼ã‚’å®Ÿç¾ã™ã‚‹ã€‚

---

### Step 5c-1: Playwrightç’°å¢ƒæ§‹ç¯‰ï¼ˆ0.5æ—¥ï¼‰

**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**:

```bash
npm install --save-dev @playwright/test
npx playwright install
```

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `playwright.config.ts`

```typescript
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },

  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
  ],

  webServer: {
    command: 'npm start',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
    timeout: 120 * 1000,
  },
});
```

**package.jsonè¿½åŠ **:

```json
{
  "scripts": {
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "test:e2e:debug": "playwright test --debug",
    "test:e2e:report": "playwright show-report"
  }
}
```

---

### Step 5c-2: èªè¨¼ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆ0.3æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `e2e/helpers/auth.ts`

```typescript
import { Page } from '@playwright/test';

/**
 * ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
 */
export async function login(page: Page, email: string, password: string) {
  await page.goto('/');
  
  // ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
  await page.click('text=ãƒ­ã‚°ã‚¤ãƒ³');
  
  // Firebase UIã®è¡¨ç¤ºã‚’å¾…ã¤
  await page.waitForSelector('input[type="email"]');
  
  // èªè¨¼æƒ…å ±ã‚’å…¥åŠ›
  await page.fill('input[type="email"]', email);
  await page.fill('input[type="password"]', password);
  
  // ãƒ­ã‚°ã‚¤ãƒ³å®Ÿè¡Œ
  await page.click('button[type="submit"]');
  
  // ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†ã‚’å¾…ã¤
  await page.waitForSelector('text=é‡çƒã‚¹ã‚³ã‚¢');
}

/**
 * ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆï¼ˆåˆå›ã®ã¿ï¼‰
 */
export async function createTestUser(page: Page, email: string, password: string) {
  await page.goto('/');
  await page.click('text=æ–°è¦ç™»éŒ²');
  
  await page.fill('input[type="email"]', email);
  await page.fill('input[type="password"]', password);
  await page.click('button[type="submit"]');
  
  await page.waitForSelector('text=é‡çƒã‚¹ã‚³ã‚¢');
}

/**
 * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
 */
export async function logout(page: Page) {
  await page.click('[aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"]');
  await page.click('text=ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ');
  await page.waitForSelector('text=ãƒ­ã‚°ã‚¤ãƒ³');
}
```

---

### Step 5c-3: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ã®E2Eãƒ†ã‚¹ãƒˆï¼ˆ1.0æ—¥ï¼‰

#### ãƒ†ã‚¹ãƒˆ1: è©¦åˆä½œæˆã‹ã‚‰ä¿å­˜ã¾ã§ï¼ˆ0.3æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `e2e/game-flow.spec.ts`

```typescript
import { test, expect } from '@playwright/test';
import { login } from './helpers/auth';

test.describe('è©¦åˆä½œæˆãƒ•ãƒ­ãƒ¼', () => {
  test.beforeEach(async ({ page }) => {
    // ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
    await login(page, 'test@example.com', 'testpassword123');
  });

  test('æ–°ã—ã„è©¦åˆã‚’ä½œæˆã—ã¦ä¿å­˜ã§ãã‚‹', async ({ page }) => {
    // åˆæœŸç”»é¢ã®ç¢ºèª
    await expect(page.locator('h1')).toContainText('é‡çƒã‚¹ã‚³ã‚¢');

    // ãƒãƒ¼ãƒ åã‚’è¨­å®š
    await page.fill('input[name="home-team-name"]', 'ãƒ›ãƒ¼ã‚¯ã‚¹');
    await page.fill('input[name="away-team-name"]', 'ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹');

    // é¸æ‰‹ã‚’è¿½åŠ ï¼ˆãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ ï¼‰
    await page.click('text=ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ é¸æ‰‹è¿½åŠ ');
    await page.fill('input[name="player-name"]', 'å±±ç”°å¤ªéƒ');
    await page.fill('input[name="player-number"]', '1');
    await page.click('text=è¿½åŠ ');

    // æ‰“å¸­ã‚’è¨˜éŒ²
    await page.click('text=æ‰“å¸­ã‚’è¿½åŠ ');
    await page.selectOption('select[name="player"]', 'å±±ç”°å¤ªéƒ');
    await page.click('button[aria-label="å†…é‡å®‰æ‰“"]');
    await page.click('text=ç™»éŒ²');

    // ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ã«åæ˜ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(page.locator('[data-testid="score-board"]')).toContainText('1');

    // è©¦åˆã‚’ä¿å­˜
    await page.click('button:has-text("ä¿å­˜")');
    
    // ä¿å­˜ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
    await page.fill('input[name="game-title"]', 'ãƒ†ã‚¹ãƒˆè©¦åˆ1');
    await page.click('button:has-text("ä¿å­˜å®Ÿè¡Œ")');

    // ä¿å­˜æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    await expect(page.locator('text=ä¿å­˜ã—ã¾ã—ãŸ')).toBeVisible();

    // è©¦åˆä¸€è¦§ã§ç¢ºèª
    await page.click('button:has-text("ä¸€è¦§è¡¨ç¤º")');
    await expect(page.locator('text=ãƒ†ã‚¹ãƒˆè©¦åˆ1')).toBeVisible();
  });

  test('ä¿å­˜ã—ãŸè©¦åˆã‚’èª­ã¿è¾¼ã‚“ã§ç¶šãã‹ã‚‰å…¥åŠ›ã§ãã‚‹', async ({ page }) => {
    // è©¦åˆä¸€è¦§ã‚’é–‹ã
    await page.click('[aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"]');
    await page.click('text=è©¦åˆä¸€è¦§');

    // æœ€æ–°ã®è©¦åˆã‚’é–‹ã
    await page.click('text=ãƒ†ã‚¹ãƒˆè©¦åˆ1');

    // ãƒ‡ãƒ¼ã‚¿ãŒå¾©å…ƒã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(page.locator('input[name="home-team-name"]')).toHaveValue('ãƒ›ãƒ¼ã‚¯ã‚¹');
    await expect(page.locator('input[name="away-team-name"]')).toHaveValue('ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹');

    // è¿½åŠ ã®æ‰“å¸­ã‚’è¨˜éŒ²
    await page.click('text=æ‰“å¸­ã‚’è¿½åŠ ');
    await page.selectOption('select[name="player"]', 'å±±ç”°å¤ªéƒ');
    await page.click('button[aria-label="ä¸‰æŒ¯"]');
    await page.click('text=ç™»éŒ²');

    // ä¸Šæ›¸ãä¿å­˜
    await page.click('button:has-text("ä¿å­˜")');
    await page.click('button:has-text("ä¸Šæ›¸ãä¿å­˜")');

    await expect(page.locator('text=ä¿å­˜ã—ã¾ã—ãŸ')).toBeVisible();
  });

  test('è©¦åˆã‚’å‰Šé™¤ã§ãã‚‹', async ({ page }) => {
    await page.click('[aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"]');
    await page.click('text=è©¦åˆä¸€è¦§');

    // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    await page.click('[aria-label="ãƒ†ã‚¹ãƒˆè©¦åˆ1ã‚’å‰Šé™¤"]');
    
    // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
    await page.click('button:has-text("å‰Šé™¤ã™ã‚‹")');

    // å‰Šé™¤æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    await expect(page.locator('text=å‰Šé™¤ã—ã¾ã—ãŸ')).toBeVisible();

    // ä¸€è¦§ã‹ã‚‰æ¶ˆãˆã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(page.locator('text=ãƒ†ã‚¹ãƒˆè©¦åˆ1')).not.toBeVisible();
  });
});
```

#### ãƒ†ã‚¹ãƒˆ2: ãƒãƒ¼ãƒ ç®¡ç†ãƒ•ãƒ­ãƒ¼ï¼ˆ0.3æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `e2e/team-management.spec.ts`

```typescript
import { test, expect } from '@playwright/test';
import { login } from './helpers/auth';

test.describe('ãƒãƒ¼ãƒ ç®¡ç†ãƒ•ãƒ­ãƒ¼', () => {
  test.beforeEach(async ({ page }) => {
    await login(page, 'test@example.com', 'testpassword123');
  });

  test('æ–°ã—ã„ãƒãƒ¼ãƒ ã‚’ä½œæˆã§ãã‚‹', async ({ page }) => {
    // ãƒãƒ¼ãƒ ç®¡ç†ç”»é¢ã‚’é–‹ã
    await page.click('[aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"]');
    await page.click('text=é¸æ‰‹ç®¡ç†');

    // ã‚¿ã‚¤ãƒˆãƒ«ã®ç¢ºèª
    await expect(page.locator('h1')).toContainText('é¸æ‰‹ç®¡ç†');

    // æ–°ã—ã„ãƒãƒ¼ãƒ ã‚’ä½œæˆ
    await page.click('text=æ–°ã—ã„ãƒãƒ¼ãƒ ');
    await page.fill('input[name="team-name"]', 'ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒ ');
    await page.click('button:has-text("ä½œæˆ")');

    // ãƒãƒ¼ãƒ ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(page.locator('text=ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒ ')).toBeVisible();
  });

  test('ãƒãƒ¼ãƒ ã«é¸æ‰‹ã‚’è¿½åŠ ã§ãã‚‹', async ({ page }) => {
    await page.click('[aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"]');
    await page.click('text=é¸æ‰‹ç®¡ç†');

    // ãƒãƒ¼ãƒ ã‚’é¸æŠ
    await page.click('text=ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒ ');

    // é¸æ‰‹ã‚’è¿½åŠ 
    await page.click('text=é¸æ‰‹ã‚’è¿½åŠ ');
    await page.fill('input[name="player-name"]', 'éˆ´æœ¨ä¸€éƒ');
    await page.fill('input[name="player-number"]', '51');
    await page.selectOption('select[name="position"]', 'å¤–é‡æ‰‹');
    await page.click('button:has-text("è¿½åŠ ")');

    // é¸æ‰‹ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(page.locator('text=51 éˆ´æœ¨ä¸€éƒ')).toBeVisible();
    await expect(page.locator('text=å¤–é‡æ‰‹')).toBeVisible();
  });

  test('é¸æ‰‹ã®æ‰“é †ã‚’ä¸¦ã³æ›¿ãˆã‚‰ã‚Œã‚‹', async ({ page }) => {
    await page.click('[aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"]');
    await page.click('text=é¸æ‰‹ç®¡ç†');
    await page.click('text=ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒ ');

    // 2äººç›®ã®é¸æ‰‹ã‚’è¿½åŠ 
    await page.click('text=é¸æ‰‹ã‚’è¿½åŠ ');
    await page.fill('input[name="player-name"]', 'ç”°ä¸­äºŒéƒ');
    await page.fill('input[name="player-number"]', '25');
    await page.click('button:has-text("è¿½åŠ ")');

    // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ä¸¦ã³æ›¿ãˆ
    const firstPlayer = page.locator('[data-player-id="1"]');
    const secondPlayer = page.locator('[data-player-id="2"]');

    await firstPlayer.dragTo(secondPlayer);

    // é †ç•ªãŒå¤‰ã‚ã£ãŸã“ã¨ã‚’ç¢ºèª
    const playerList = page.locator('[data-testid="player-list"] li');
    await expect(playerList.first()).toContainText('ç”°ä¸­äºŒéƒ');
    await expect(playerList.last()).toContainText('éˆ´æœ¨ä¸€éƒ');
  });
});
```

#### ãƒ†ã‚¹ãƒˆ3: æˆç¸¾è¡¨ç¤ºãƒ•ãƒ­ãƒ¼ï¼ˆ0.2æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `e2e/stats-display.spec.ts`

```typescript
import { test, expect } from '@playwright/test';
import { login } from './helpers/auth';

test.describe('æˆç¸¾è¡¨ç¤ºãƒ•ãƒ­ãƒ¼', () => {
  test.beforeEach(async ({ page }) => {
    await login(page, 'test@example.com', 'testpassword123');
  });

  test('é€šç®—æˆç¸¾ã‚’è¡¨ç¤ºã§ãã‚‹', async ({ page }) => {
    // æˆç¸¾ç”»é¢ã‚’é–‹ã
    await page.click('[aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"]');
    await page.click('text=é€šç®—æˆç¸¾');

    // ã‚¿ã‚¤ãƒˆãƒ«ã®ç¢ºèª
    await expect(page.locator('h1')).toContainText('é€šç®—æˆç¸¾');

    // é¸æ‰‹ã®æˆç¸¾ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(page.locator('[data-testid="stats-table"]')).toBeVisible();
    
    // æ‰“ç‡ã€æ‰“ç‚¹ãªã©ã®æŒ‡æ¨™ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(page.locator('th:has-text("æ‰“ç‡")')).toBeVisible();
    await expect(page.locator('th:has-text("æ‰“ç‚¹")')).toBeVisible();
    await expect(page.locator('th:has-text("æœ¬å¡æ‰“")')).toBeVisible();
  });

  test('ãƒãƒ¼ãƒ åˆ¥ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ãã‚‹', async ({ page }) => {
    await page.click('[aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"]');
    await page.click('text=é€šç®—æˆç¸¾');

    // ãƒãƒ¼ãƒ ãƒ•ã‚£ãƒ«ã‚¿ã‚’é¸æŠ
    await page.selectOption('select[name="team-filter"]', 'ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒ ');

    // ãƒ•ã‚£ãƒ«ã‚¿ã•ã‚ŒãŸçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(page.locator('text=éˆ´æœ¨ä¸€éƒ')).toBeVisible();
  });
});
```

---

### Step 5c-4: Visual Regression Testingï¼ˆOptionalï¼‰ï¼ˆ0.2æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `e2e/visual-regression.spec.ts`

```typescript
import { test, expect } from '@playwright/test';
import { login } from './helpers/auth';

test.describe('ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ', () => {
  test('ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãŒä¸€è‡´ã™ã‚‹', async ({ page }) => {
    await login(page, 'test@example.com', 'testpassword123');

    // ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±
    const scoreBoard = page.locator('[data-testid="score-board"]');
    await expect(scoreBoard).toHaveScreenshot('score-board.png');
  });

  test('ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãŒä¸€è‡´ã™ã‚‹', async ({ page }) => {
    await login(page, 'test@example.com', 'testpassword123');

    // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
    await page.click('[aria-label="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ"]');

    // å…¨ä½“ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±
    await expect(page).toHaveScreenshot('dark-mode.png', {
      fullPage: true,
    });
  });

  test('ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãŒä¸€è‡´ã™ã‚‹', async ({ page }) => {
    // ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã‚’ãƒ¢ãƒã‚¤ãƒ«ã‚µã‚¤ã‚ºã«è¨­å®š
    await page.setViewportSize({ width: 375, height: 667 });
    
    await login(page, 'test@example.com', 'testpassword123');

    await expect(page).toHaveScreenshot('mobile-view.png');
  });
});
```

---

### Step 5c-5: CI/CDã¸ã®çµ±åˆï¼ˆ0.2æ—¥ï¼‰

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `.github/workflows/e2e.yml`

```yaml
name: E2E Tests

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  e2e-tests:
    name: E2E Tests
    runs-on: ubuntu-latest
    timeout-minutes: 20

    strategy:
      matrix:
        browser: [chromium, firefox, webkit]

    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Setup Node.js
        uses: actions/setup-node@v5
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright Browsers
        run: npx playwright install --with-deps ${{ matrix.browser }}

      - name: Build app
        run: npm run build

      - name: Run E2E tests
        run: npx playwright test --project=${{ matrix.browser }}
        env:
          CI: true

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report-${{ matrix.browser }}
          path: playwright-report/
          retention-days: 7

      - name: Upload screenshots
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-screenshots-${{ matrix.browser }}
          path: test-results/
          retention-days: 7
```

**package.jsonè¿½åŠ **:

```json
{
  "scripts": {
    "test:e2e:ci": "playwright test --reporter=github"
  }
}
```

---

### Phase 5cå—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] Playwrightç’°å¢ƒæ§‹ç¯‰å®Œäº†
- [ ] è©¦åˆä½œæˆãƒ•ãƒ­ãƒ¼ã®E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ3ã‚·ãƒŠãƒªã‚ªï¼‰
- [ ] ãƒãƒ¼ãƒ ç®¡ç†ãƒ•ãƒ­ãƒ¼ã®E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ3ã‚·ãƒŠãƒªã‚ªï¼‰
- [ ] æˆç¸¾è¡¨ç¤ºãƒ•ãƒ­ãƒ¼ã®E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ2ã‚·ãƒŠãƒªã‚ªï¼‰
- [ ] Visual Regression Testingã®å®Ÿè£…ï¼ˆOptionalï¼‰
- [ ] CI/CDã¸ã®çµ±åˆå®Œäº†
- [ ] å…¨E2Eãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹
- [ ] chromiumã€firefoxã€webkitã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

**å·¥æ•°**: 2.0æ—¥

---

## ğŸ“Š v4.0å…¨ä½“ã®åŠ¹æœæ¸¬å®š

### å®šé‡çš„åŠ¹æœ

| æŒ‡æ¨™ | Phase 5a | Phase 5b | Phase 5c | åˆè¨ˆ |
|------|----------|----------|----------|------|
| ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š | +20% | +15% | +10% | **+45%** |
| App.tsxè¡Œæ•°å‰Šæ¸› | -1,207è¡Œ | - | - | **-1,207è¡Œ** |
| ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“çŸ­ç¸® | -10ç§’ | -20ç§’ | - | **-30ç§’** |
| æ–°è¦ãƒã‚°æ¤œå‡ºæ•° | +5å€‹ | +3å€‹ | +8å€‹ | **+16å€‹** |

### å®šæ€§çš„åŠ¹æœ

#### ã‚³ãƒ¼ãƒ‰å“è³ª
- âœ… **å¯èª­æ€§**: ã‚«ã‚¹ã‚¿ãƒ Hooksã«ã‚ˆã‚Šè²¬å‹™ãŒæ˜ç¢ºåŒ–
- âœ… **ä¿å®ˆæ€§**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢ã«ã‚ˆã‚Šå¤‰æ›´å½±éŸ¿ç¯„å›²ãŒé™å®š
- âœ… **æ‹¡å¼µæ€§**: Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚Šæ–°æ©Ÿèƒ½è¿½åŠ ãŒå®¹æ˜“
- âœ… **ä¿¡é ¼æ€§**: E2Eãƒ†ã‚¹ãƒˆã«ã‚ˆã‚Šãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ¤œå‡ºãŒè‡ªå‹•åŒ–

#### é–‹ç™ºä½“é¨“
- âœ… **ãƒ†ã‚¹ãƒˆã®æ›¸ãã‚„ã™ã•**: MockRepositoryã«ã‚ˆã‚Šå˜ä½“ãƒ†ã‚¹ãƒˆãŒç°¡å˜
- âœ… **ãƒ‡ãƒãƒƒã‚°ã®ã—ã‚„ã™ã•**: è²¬å‹™ãŒåˆ†é›¢ã•ã‚Œã¦ã„ã‚‹ãŸã‚å•é¡Œç®‡æ‰€ã®ç‰¹å®šãŒå®¹æ˜“
- âœ… **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã—ã‚„ã™ã•**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå°ã•ãå·®åˆ†ãŒæ˜ç¢º
- âœ… **å­¦ç¿’ã®ã—ã‚„ã™ã•**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæ•´ç†ã•ã‚Œã¦ãŠã‚Šæ–°ãƒ¡ãƒ³ãƒãƒ¼ã®ç†è§£ãŒé€Ÿã„

---

## ğŸ¯ å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ: æ®µéšçš„å®Ÿè£…

```
Week 1-2: Phase 5aï¼ˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼‰
  Day 1-3: useGameStateã¨ScoreCalculatorã‚’å®Ÿè£…
  Day 4-5: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šã€åŠ¹æœæ¤œè¨¼
  â†’ åŠ¹æœãŒç¢ºèªã§ãã‚Œã°ç¶šè¡Œã€å•é¡ŒãŒã‚ã‚Œã°æ–¹é‡è¦‹ç›´ã—

Week 3-4: Phase 5aï¼ˆæœ¬æ ¼å±•é–‹ï¼‰
  Day 1-3: æ®‹ã‚Šã®Hooksã¨ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
  Day 4-5: App.tsxãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€çµ±åˆãƒ†ã‚¹ãƒˆ

Week 5-6: Phase 5b
  Day 1-2: Repositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨å®Ÿè£…
  Day 3-4: Dependency Injectionå®Ÿè£…
  Day 5: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç§»è¡Œã€ãƒ†ã‚¹ãƒˆ

Week 7-8: Phase 5c
  Day 1-2: Playwrightç’°å¢ƒæ§‹ç¯‰ã€èªè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼
  Day 3-5: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ã®E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…
  Day 6-7: CI/CDçµ±åˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™
  Day 8: æœ€çµ‚æ¤œè¨¼ã€ãƒªãƒªãƒ¼ã‚¹æº–å‚™
```

### ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

| Week | ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ | æ¤œè¨¼é …ç›® |
|------|--------------|---------|
| 2é€±ç›® | Phase 5a MVPå®Œæˆ | ã‚«ãƒãƒ¬ãƒƒã‚¸+10%é”æˆ |
| 4é€±ç›® | Phase 5aå®Œæˆ | App.tsx < 500è¡Œé”æˆ |
| 6é€±ç›® | Phase 5bå®Œæˆ | ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“-50%é”æˆ |
| 8é€±ç›® | Phase 5cå®Œæˆ | E2Eãƒ†ã‚¹ãƒˆ8ä»¶ä»¥ä¸Šå®Ÿè£… |

---

## ğŸ”„ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥

### Phaseåˆ¥ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ

**Phase 5a**:
- Step 5a-1: ã‚«ã‚¹ã‚¿ãƒ Hooksã®ã¿ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
- Step 5a-2: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®ã¿ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
- Step 5a-3: App.tsxã®å¤‰æ›´ã®ã¿ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

**Phase 5b**:
- Step 5b-1ï½5b-3: Repositoryå®Ÿè£…ã®ã¿ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¯ãã®ã¾ã¾ï¼‰
- Step 5b-4ï½5b-5: DIå®Ÿè£…ã¨ç§»è¡Œã‚’ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

**Phase 5c**:
- E2Eãƒ†ã‚¹ãƒˆã¯æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ã—ãªã„ãŸã‚ã€ã„ã¤ã§ã‚‚ç„¡åŠ¹åŒ–å¯èƒ½

### ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

```bash
# ç‰¹å®šã®Phaseã‚’ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
git revert <phase-5a-merge-commit>

# éƒ¨åˆ†çš„ãªãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
git revert <specific-commit>

# å®Œå…¨ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆv3.0ã«æˆ»ã‚‹ï¼‰
git checkout v3.0
git checkout -b rollback-v4
```

---

## ğŸš€ v4.0å®Ÿè£…é–‹å§‹ã®åˆ¤æ–­åŸºæº–

### å³åº§ã«å®Ÿæ–½ã™ã¹ãå ´åˆ

- âœ… v3.0å®Œäº†å¾Œã€ã‚«ãƒãƒ¬ãƒƒã‚¸30-60%ã‚’é”æˆã—ã¦ã„ã‚‹
- âœ… ãƒãƒ¼ãƒ è¦æ¨¡ãŒ3äººä»¥ä¸Šã«æ‹¡å¤§ã™ã‚‹äºˆå®šãŒã‚ã‚‹
- âœ… æ–°æ©Ÿèƒ½é–‹ç™ºã®é »åº¦ãŒé€±1å›ä»¥ä¸Šã‚ã‚‹
- âœ… ãƒã‚°ä¿®æ­£æ™‚é–“ãŒé–‹ç™ºæ™‚é–“ã‚’åœ§è¿«ã—ã¦ã„ã‚‹
- âœ… App.tsxã®å¤‰æ›´ãŒé »ç¹ã§å½±éŸ¿ç¯„å›²ãŒä¸æ˜ç¢º

### æ§˜å­è¦‹ãŒå¦¥å½“ãªå ´åˆ

- âš ï¸ v3.0å®Œäº†ç›´å¾Œã§åŠ¹æœæ¸¬å®šæœŸé–“ãŒå¿…è¦
- âš ï¸ ãƒãƒ¼ãƒ ãŒ1-2äººã§å®‰å®šã—ã¦ã„ã‚‹
- âš ï¸ æ–°æ©Ÿèƒ½é–‹ç™ºã®é »åº¦ãŒä½ã„
- âš ï¸ ç¾çŠ¶ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã§å“è³ªãŒå®‰å®šã—ã¦ã„ã‚‹
- âš ï¸ ä»–ã®å„ªå…ˆåº¦ã®é«˜ã„æ©Ÿèƒ½é–‹ç™ºãŒã‚ã‚‹

### æ¨å¥¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°

**v3.0å®Œäº†ã‹ã‚‰3ãƒ¶æœˆå¾Œ**ã«ä»¥ä¸‹ã‚’è©•ä¾¡ï¼š

1. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¨ç§»
2. ãƒã‚°ç™ºç”Ÿé »åº¦
3. é–‹ç™ºé€Ÿåº¦ã®å¤‰åŒ–
4. ãƒãƒ¼ãƒ è¦æ¨¡ã®å¤‰åŒ–
5. æŠ€è¡“çš„è² å‚µã®è“„ç©çŠ¶æ³

â†’ 3ãƒ¶æœˆé–“ã®åŠ¹æœæ¸¬å®šãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«ã€v4.0ç€æ‰‹ã‚’æœ€çµ‚åˆ¤æ–­

---

## ğŸ“ˆ æŠ•è³‡å¯¾åŠ¹æœï¼ˆROIï¼‰åˆ†æ

### åˆæœŸæŠ•è³‡

- **å·¥æ•°**: 8é€±é–“ï¼ˆ1äººï¼‰ã¾ãŸã¯ 4é€±é–“ï¼ˆ2äººï¼‰
- **æ™‚é–“**: ç´„160æ™‚é–“
- **ã‚³ã‚¹ãƒˆ**: é–‹ç™ºè€…å˜ä¾¡ Ã— 160æ™‚é–“

### æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³

**çŸ­æœŸçš„åŠ¹æœï¼ˆ6ãƒ¶æœˆä»¥å†…ï¼‰**:
- ãƒã‚°ä¿®æ­£æ™‚é–“å‰Šæ¸›: 40æ™‚é–“ â†’ **æŠ•è³‡å›åæœŸé–“4ãƒ¶æœˆ**
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“çŸ­ç¸®: å¹´é–“50æ™‚é–“ç›¸å½“
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ™‚ã®å®‰å…¨æ€§å‘ä¸Š: ç„¡å½¢ä¾¡å€¤

**ä¸­é•·æœŸçš„åŠ¹æœï¼ˆ1å¹´ä»¥é™ï¼‰**:
- é–‹ç™ºé€Ÿåº¦å‘ä¸Š: 50%ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ— â†’ å¹´é–“200æ™‚é–“ã®è¿½åŠ é–‹ç™ºæ™‚é–“
- æ–°ãƒ¡ãƒ³ãƒãƒ¼ã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‰æ™‚é–“çŸ­ç¸®: 1é€±é–“ â†’ 3æ—¥ï¼ˆ4æ—¥çŸ­ç¸®ï¼‰
- æŠ€è¡“çš„è² å‚µã®è¿”æ¸ˆ: ä»Šå¾Œã®å¤§è¦æ¨¡æ”¹ä¿®ãƒªã‚¹ã‚¯è»½æ¸›

**å®šé‡åŒ–**:
```
åˆæœŸæŠ•è³‡: 160æ™‚é–“
1å¹´ç›®ãƒªã‚¿ãƒ¼ãƒ³: 290æ™‚é–“ï¼ˆä¿®æ­£40h + çŸ­ç¸®50h + è¿½åŠ 200hï¼‰
ROI: (290 - 160) / 160 = 81%
```

**çµè«–**: **æŠ•è³‡ã™ã‚‹ä¾¡å€¤ã¯æ¥µã‚ã¦é«˜ã„**

---

## ğŸ“ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

### v4.0å®Œäº†æ™‚ã«ä½œæˆã™ã¹ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

1. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** (`docs/architecture.md`)
   - ã‚«ã‚¹ã‚¿ãƒ Hooksã®è²¬å‹™ã¨ä½¿ç”¨æ–¹æ³•
   - Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…è©³ç´°
   - ä¾å­˜æ³¨å…¥ã®ä»•çµ„ã¿

2. **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** (`docs/testing-strategy.md`)
   - å˜ä½“ãƒ†ã‚¹ãƒˆã€çµ±åˆãƒ†ã‚¹ãƒˆã€E2Eãƒ†ã‚¹ãƒˆã®æ–¹é‡
   - ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ã¨æ¸¬å®šæ–¹æ³•
   - MockRepositoryã®ä½¿ç”¨æ–¹æ³•

3. **ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‚¬ã‚¤ãƒ‰** (`CONTRIBUTING.md`)
   - æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
   - Hooksã¨ã‚µãƒ¼ãƒ“ã‚¹ã®ä½œæˆãƒ«ãƒ¼ãƒ«
   - ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹

4. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰** (`docs/migration-v3-to-v4.md`)
   - v3.0ã‹ã‚‰v4.0ã¸ã®ç§»è¡Œæ‰‹é †
   - ç ´å£Šçš„å¤‰æ›´ã®ä¸€è¦§
   - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ–¹æ³•

---

## ğŸ”— å‚è€ƒè³‡æ–™

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

- [Clean Architecture in React](https://dev.to/rubemfsv/clean-architecture-applying-with-react-40h6)
- [Repository Pattern](https://martinfowler.com/eaaCatalog/repository.html)
- [Dependency Injection in React](https://javascript.plainenglish.io/dependency-injection-in-react-a6c3d5d0db76)
- [Custom Hooks Best Practices](https://react.dev/learn/reusing-logic-with-custom-hooks)

### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

- [Testing Trophy](https://kentcdodds.com/blog/the-testing-trophy-and-testing-classifications)
- [React Testing Best Practices](https://github.com/goldbergyoni/javascript-testing-best-practices)
- [Playwright Documentation](https://playwright.dev/)
- [Jest Documentation](https://jestjs.io/)

### ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•

- [Refactoring by Martin Fowler](https://refactoring.com/)
- [Working Effectively with Legacy Code](https://www.goodreads.com/book/show/44919.Working_Effectively_with_Legacy_Code)
- [React Patterns](https://reactpatterns.com/)

---

## ğŸ“… å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | ä½œæˆè€… |
|-----------|------|---------|--------|
| 4.0 | 2025-10-07 | åˆç‰ˆä½œæˆï¼šPhase 5ä»¥é™ã®è©³ç´°å®Ÿè£…è¨ˆç”» | AI Assistant |

---

## ğŸ“ è³ªå•ãƒ»ç›¸è«‡

v4.0ã®å®Ÿè£…ã«é–¢ã™ã‚‹è³ªå•ã‚„ç›¸è«‡ã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ã§å—ã‘ä»˜ã‘ã¾ã™ï¼š

1. **GitHubã‚¤ã‚·ãƒ¥ãƒ¼**: æŠ€è¡“çš„ãªè³ªå•ã‚„ææ¡ˆ
2. **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: å…·ä½“çš„ãªå®Ÿè£…ã«é–¢ã™ã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼
3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**: ä¸æ˜ç‚¹ã‚„æ”¹å–„ææ¡ˆ

**v4.0ã¯æ®µéšçš„ã«å®Ÿè£…å¯èƒ½ã§ã™ã€‚ã¾ãšã¯Phase 5aã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‹ã‚‰å§‹ã‚ã€åŠ¹æœã‚’æ¤œè¨¼ã—ãªãŒã‚‰é€²ã‚ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚**

