---
title: 野球スコアアプリ UI 改善 実装計画（PR分割案付き）
language: ja
assumptions:
  - 対象は `src/App.tsx` 配下のSPA（MUI v5）
  - 主要フロー: 試合の作成/入力、チーム管理、試合一覧、共有閲覧
  - デバイス幅: 375 / 768 / 1280 を優先検証
  - ブランディング: シンプル・スピーディ・信頼感
  - 非目標: リブランディング、技術基盤の大規模刷新
references:
  - Apple HIG, Material 3, WCAG 2.2 AA, Core Web Vitals
---

## 1. スコープと課題（抜粋）

- 画面: `AppBar`/ヘッダー、スコアボード、打席入力（`AtBatForm`/履歴）、試合一覧、チーム管理、共有閲覧
- 初見課題:
  - フォーカス可視性やキーボード操作の明確化（WCAG 2.4.7, MD States）
  - モバイルでのタップ領域と密度の最適化（HIG 44pt, MD 48dp）
  - 重要操作の優先順位と情報階層の整理（HIG/MD ナビゲーション/階層）
  - 共有モードの状態説明と制約の案内（Nielsen #1 状態の視認性）
  - 非同期操作の状態表示統一（Nielsen #1、MD Progress）
  - スコアボードの横スクロール/可視指標（アクセシビリティと可用性）
  - Web Vitals と体感速度（INP/LCP、スケルトン/遅延読込）

## 2. 実装方針

- まずアクセシビリティ/操作性/情報設計の基盤改善 → 次に視覚的洗練 → 最後にパフォーマンス最適化。
- 変更は小さく安全に、PRを小分け（1〜3画面影響 or スタイルトークン単位）で出す。

## 3. PR 分割計画（優先度順）

### PR-01: フォーカス可視化・タップ領域の共通トークン導入（全体）

- 目的: キーボード/スクリーンリーダー利用時の可視性と誤タップ低減。
- 変更点:
  - `Theme` 拡張: フォーカスアウトライン色/幅/半径/オフセットのトークン追加。
  - MUIコンポーネントの共通 `sx`/`theme.components` で `:focus-visible` スタイル適用。
  - 主要操作ボタンの最小タップ領域（≥44pt/48dp）をモバイル時に保証。
- 根拠: WCAG 2.4.7, HIG タップ領域, MD States。
- 影響範囲: `AppBar` ボタン群、`Dialog` 内アクション、タブ/テーブル操作。
- 受け入れ条件: キーボードTab移動で常に明確なリング表示、主要ボタンのヒットボックス≥44px。

### PR-02: ヘッダー情報設計の整理とラベル/ARIA改善（AppBar）

- 目的: 重要操作の探索容易性、共有モード時の状態伝達強化。
- 変更点:
  - 共有モードの制約をヘッダー副次テキスト/`aria-live=polite`で周知。
  - アイコンボタンに `aria-label`/`title` の統一追加、`Menu` 開閉の `aria-controls`/`aria-expanded` 連携。
  - 日付ボタンを `button`+`aria-describedby` で説明テキスト紐付け。
- 根拠: Nielsen #1/4, WCAG 1.3.1/4.1.2。
- 受け入れ条件: VoiceOver/NVDAで機能名と状態が伝わる。

### PR-03: スコアボードの可読性/可視指標改善（`ScoreBoard.tsx`）

- 目的: 現在イニング/合計の視認性、横スクロールの手掛かり強化。
- 変更点:
  - スティッキー列/合計列のコントラストと影付与、現在イニングのコントラスト強化。
  - スクロールヒント（グラデーション/アイコン）を `TableContainer` 右端に追加。
  - テーブル見出しに `scope="col"`、行頭に `scope="row"` を付与。
  - 合計列に `aria-label` と `title` を追加し、合計の意味を明確化。
- 根拠: WCAG 1.4.3/2.4.6、MD Data tables。
- 受け入れ条件: モバイルで横スクロールが発見可能、見出し読み上げが意味を伝える。

### PR-04: 打席入力フォームの誤入力防止と編集フロー改善（`AtBatForm.tsx`）

- 目的: エラープリベンション、Undo/キャンセル性、視覚的カテゴリー化。
- 変更点:
  - `required`/`aria-invalid`/`aria-describedby` で入力要件を明示。
  - `Select` グループに `ListSubheader` のロール適切化、色だけに依存しないカテゴリーアイコン/テキスト併用。
  - 送信後のフィードバック `aria-live`（polite）で登録完了を告知。
  - キャンセルのフォーカス返却（モーダルを閉じるボタンへ）。
- 根拠: Nielsen #5/#9, WCAG 1.4.1/3.3.1/3.3.3。
- 受け入れ条件: キーボードのみでフォーム完了、誤入力時に具体的メッセージ提示。

### PR-05: 非同期操作の状態表示と冪等性（保存/読み込み/追加系）

- 目的: ユーザーの主導権、状態の視認性、重複送信防止。
- 変更点:
  - 保存/読み込みボタンにローディング状態（`loading`/`disabled`）と進行中テキストを付加。
  - `Snackbar` のLive Region属性最適化（`role=status`/`aria-live=polite`）。
  - ロングタスクにキャンセル手段（閉じる/リトライ）を明示。
- 根拠: Nielsen #1/#3、MD Progress。
- 受け入れ条件: 通信遅延時も状態が明確で二重送信が起きない。

### PR-06: 共有モードのガイダンス/戻り導線の明確化

- 目的: 制約の理解、アプリ本体への復帰動線の明確さ向上。
- 変更点:
  - 共有モードバナーに「編集不可/保存不可」等の説明を常設（非干渉）。
  - `HelpDialog` に共有モード章を追加し、`AppBar` から同章へジャンプ可能に。
- 根拠: Nielsen #1/#10。
- 受け入れ条件: 新規ユーザーが共有画面だけでも迷わず閲覧完了できる。

### PR-07: パフォーマンス初期対応（LCP/INP/CLS）

- 目的: 体感速度向上と操作応答性安定。
- 変更点:
  - `Stepper`/表の初期レンダを軽量化（メモ化/条件描画）。
  - 大きなアイコン/画像の`loading=lazy`、不要ログの削除（`console.log`）。
  - 遅延読み込み（ヘルプ/一覧など非クリティカルなダイアログ群）。
- 根拠: Core Web Vitals。
- 受け入れ条件: Lighthouse Performance 80+、INP < 200ms 目標。

### PR-08: 回帰テストとA11y自動チェック導入

- 目的: 変更の安全性と継続的品質。
- 変更点:
  - `@axe-core/react`（開発時）と `lighthouse-ci` ワークフローの雛形。
  - 主要フローの`jest+@testing-library/react`でキーボード操作テストを追加。
- 根拠: Nielsen #9、WCAG継続担保。
- 受け入れ条件: CIでA11y重大エラー0、主要操作のテスト合格。

## 4. 実装チェックリスト（受け入れ条件の横断）

- フォーカスリングは常に背景とコントラスト比≥3:1。
- 主要ボタンのタップ領域≥44×44（モバイル想定）。
- テーブル見出しの `scope`/`th` の適切化、行ヘッダあり。
- ダイアログのオープン/クローズでフォーカスを適切に返却。
- スクロール領域に視覚的な手掛かり（グラデーション/インジケータ）。
- ローディング・エラー・完了を視覚/音声で通知（polite/status）。

## 5. 検証計画

- 定量: Lighthouse A11y ≥ 95、Performance ≥ 80、INP < 200ms、CLS < 0.1。
- 定性: 主要タスク（スコア入力、保存、共有閲覧）をキーボードのみで実行し、成功率≥90%、完了≤90秒。

## 6. 工数目安とリスク

- PR-01〜04: 各0.5〜1.0日、PR-05〜07: 各0.5〜1.0日、PR-08: 1.0〜1.5日。
- リスク: MUIテーマ変更に伴う細かな回帰 → Story/スクショ比較/axeで検知。

## 7. 依存関係

- PR-01（トークン）が前提となりPR-02〜06に適用。
- PR-07（パフォーマンス）は随時並行可能だが、大規模UI差分前は控えめに。
- PR-08（検証）はPR-01完了後に導入し、以降のPRで運用。
